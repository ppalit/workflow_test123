name: Create App Folder from Templates

on:
  workflow_dispatch:
    inputs:
      app_name:
        description: "Enter the name of your app (e.g., app1, app2)"
        required: true
      predefined_option:
        description: "Select a predefined option (or leave empty for manual selection)"
        required: false
        type: choice
        options:
          - ""
          - "Option1"
          - "Option2"
          - "Option3"
      manual_templates:
        description: "Select additional template files (comma-separated)"
        required: false
        type: choice
        options:
          - ""
          - "ref1.txt"
          - "ref2.txt"
          - "ref3.txt"
          - "ref4.txt"
          - "ref5.txt"

permissions:
  contents: write

jobs:
  create-folder:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Determine Selected Templates
        id: select_templates
        run: |
          # Set predefined templates
          SELECTED_FILES=""
          case "${{ github.event.inputs.predefined_option }}" in
            "Option1")
              SELECTED_FILES="ref1.txt,ref5.txt"
              ;;
            "Option2")
              SELECTED_FILES="ref2.txt,ref3.txt"
              ;;
            "Option3")
              SELECTED_FILES="ref4.txt"
              ;;
          esac
          
          # Add manually selected templates
          if [[ -n "${{ github.event.inputs.manual_templates }}" ]]; then
            if [[ -n "$SELECTED_FILES" ]]; then
              SELECTED_FILES="$SELECTED_FILES,${{ github.event.inputs.manual_templates }}"
            else
              SELECTED_FILES="${{ github.event.inputs.manual_templates }}"
            fi
          fi

          echo "Final selected files: $SELECTED_FILES"
          echo "files=$SELECTED_FILES" >> $GITHUB_ENV

      - name: Create App Folder and Copy Files
        run: |
          mkdir -p "${{ github.event.inputs.app_name }}"
          IFS=',' read -ra FILES <<< "$files"
          for file in "${FILES[@]}"; do
            if [[ -f "example/$file" ]]; then
              cp "example/$file" "${{ github.event.inputs.app_name }}/"
            else
              echo "Warning: example/$file does not exist."
            fi
          done

      - name: Commit and Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions@github.com"
          git add .
          git commit -m "Created folder ${{ github.event.inputs.app_name }} with selected templates" || echo "No changes to commit"
          git push origin HEAD:main
